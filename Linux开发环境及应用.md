# Linux开发环境及应用

- 0为stdin，1为stdout，2为stderr

- 选项`--`以显式方式说明选项结束。例：删除名为-f的文件：`rm -- -f`或者`rm ./-f`
- gcc编译：`gcc ./xxx.c -o xxx`或者`make xxx`
- 使用重定向默认只会重定向stdout，若要打印错误日志需要`xxx 2>&1 | yyy`
- select系统调用的的用途是：在一段指定的时间内，监听用户感兴趣的文件描述符上可读、可写和异常等事件（非阻塞）。用户首先将需要进行IO操作的socket添加到select中，然后阻塞等待select系统调用返回。当数据到达时，socket被激活，select函数返回。用户线程正式发起read请求，读取数据并继续执行。从流程上来看，使用select函数进行IO请求和同步阻塞模型没有太大的区别，甚至还多了添加监视socket，以及调用select函数的额外操作，效率更差。但是，使用select以后最大的优势是用户可以在一个线程内同时处理多个socket的IO请求。用户可以注册多个socket，然后不断地调用select读取被激活的socket，即可达到在同一个线程内同时处理多个IO请求的目的。而在同步阻塞模型中，必须通过多线程的方式才能达到这个目的。
- 僵尸进程会占用系统进程表表项，过多导致无法启动新的进程。
- 目录的x权限：控制是否能访问该目录下的文件。
- gzip属于“无损”压缩，对于有损压缩算法压缩过的文件没有什么效果。
- 当发出信号中断的进程正处于“用户态”执行时，SIGINT信号表现如同执行中断服务程序一样。但是当信号中断的进程处于阻塞态的系统调用时，系统调用将被打断返回-1，而不是恢复阻塞状态继续执行。
- UNIX系统非常健壮，由于采用虚拟内存保护技术，数组越界等问题只会导致当前进程中止，不会导致系统崩溃。但如果信号量、管道等系统调用时设计不当，也可能产生死锁导致系统资源用尽崩溃。
- fork后由于copy-on-write技术存在，父子进程共享同一物理内存（包括代码段、数据段、堆栈段），内存占用增加不多。
- UDP：可能因为接收发送方速率不同导致数据包被丢弃。但是编程时socket收到的UDP报文不会产生误码等错误（有链路层校验）。
- socket的read系统调用返回值为0表示tcp连接关闭。
- Windows文本文件结尾：CRLF（回车换行），Linux：LF（换行）。
- 策略与机制分离：实现简单、灵活性高。例：使用管道和重定向方式组合多个命令完成复杂功能。SUID权限。B-Shell中的四则运算。条件判断。
- Linux系统PATH不含当前目录原因：安全考虑，防止恶意程序伪装成常用命令运行。如果PATH里有当前目录./，会导致系统命令被当前目录下同名程序重载，造成危险。
- C语言中longjmp和goto区别：
	- 范围不同：goto子程序内跳转，longjmp全局范围跳转。
	- 语义不同：goto仅程序执行流程跳转，longjmp恢复实现记录下来的堆栈现场，从那个地方重新开始执行。

## 正则

| 元字符    | 含义                         |
| --------- | ---------------------------- |
| ^         | 以.\*开头                    |
| \$        | 以.\*结尾                    |
| .         | 匹配任一字符                 |
| \*        | 匹配0个或多个                |
| [ ]       | 匹配集合中的                 |
| [x-y]     | 匹配集合范围内的             |
| [^ ]      | 匹配非集合中的               |
| \         | 转义                         |
|           |                              |
| \\<       | 以.\*开头                    |
| \\>       | 以.\*结尾                    |
| \\(...\\) | 标签匹配，用\\1\，\2引导标签 |

### 搭配sed

```
sed 's/book/books/' file
```

一行内全部替换：

```
sed 's/book/books/g' file
```

- 将日-月-年替换为年.月.日：`s/\([0-9][0-9]*\)-\([0-9][0-9]*\)-\([0-9][0-9]*\)/\3.\2.1/`

## find

```shell
find   path   -option   [   -print ]   [ -exec   -ok   command ]   {} \;
```

`{}` means "the output of `find`". As in, "whatever `find` found". `find` returns the path of the file you're looking for, right? So `{}` replaces it; it's a placeholder for each file that the `find` command locates (taken from [here](http://kb.iu.edu/data/admm.html)).

find命令可以在指定目录树中查找满足某个条件的文件或目录，并对查找到的对象执行一个动作。

按名称查找：-name

- 例：检索目录src及其子孙目录的所有后缀.c和.h文件，查找哪些文件中含有字符串TPDU，列出行号：`find ./src -name "*.[ch]" -exec grep -n TPDU {} /dev/null \;`

常用：

- -name<范本样式>：指定字符串作为寻找文件或目录的范本样式；
- -type<文件类型>：只寻找符合指定的文件类型的文件；
- -user<拥有者名称>：查找符和指定的拥有者名称的文件或目录；
- -ls：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出；

```
-amin<分钟>：查找在指定时间曾被存取过的文件或目录，单位以分钟计算；
-anewer<参考文件或目录>：查找其存取时间较指定文件或目录的存取时间更接近现在的文件或目录；
-atime<24小时数>：查找在指定时间曾被存取过的文件或目录，单位以24小时计算；
-cmin<分钟>：查找在指定时间之时被更改过的文件或目录；
-cnewer<参考文件或目录>查找其更改时间较指定文件或目录的更改时间更接近现在的文件或目录；
-ctime<24小时数>：查找在指定时间之时被更改的文件或目录，单位以24小时计算；
-daystart：从本日开始计算时间；
-depth：从指定目录下最深层的子目录开始查找；
-empty：寻找文件大小为0 Byte的文件，或目录下没有任何子目录或文件的空目录；
-exec<执行指令>：假设find指令的回传值为True，就执行该指令；
-false：将find指令的回传值皆设为False；
-fls<列表文件>：此参数的效果和指定“-ls”参数类似，但会把结果保存为指定的列表文件；
-follow：排除符号连接；
-fprint<列表文件>：此参数的效果和指定“-print”参数类似，但会把结果保存成指定的列表文件；
-fprint0<列表文件>：此参数的效果和指定“-print0”参数类似，但会把结果保存成指定的列表文件；
-fprintf<列表文件><输出格式>：此参数的效果和指定“-printf”参数类似，但会把结果保存成指定的列表文件；
-fstype<文件系统类型>：只寻找该文件系统类型下的文件或目录；
-gid<群组识别码>：查找符合指定之群组识别码的文件或目录；
-group<群组名称>：查找符合指定之群组名称的文件或目录；
-help或——help：在线帮助；
-ilname<范本样式>：此参数的效果和指定“-lname”参数类似，但忽略字符大小写的差别；
-iname<范本样式>：此参数的效果和指定“-name”参数类似，但忽略字符大小写的差别；
-inum<inode编号>：查找符合指定的inode编号的文件或目录；
-ipath<范本样式>：此参数的效果和指定“-path”参数类似，但忽略字符大小写的差别；
-iregex<范本样式>：此参数的效果和指定“-regexe”参数类似，但忽略字符大小写的差别；
-links<连接数目>：查找符合指定的硬连接数目的文件或目录；
-iname<范本样式>：指定字符串作为寻找符号连接的范本样式；
-ls：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出；
-maxdepth<目录层级>：设置最大目录层级；
-mindepth<目录层级>：设置最小目录层级；
-mmin<分钟>：查找在指定时间曾被更改过的文件或目录，单位以分钟计算；
-mount：此参数的效果和指定“-xdev”相同；
-mtime<24小时数>：查找在指定时间曾被更改过的文件或目录，单位以24小时计算；
-name<范本样式>：指定字符串作为寻找文件或目录的范本样式；
-newer<参考文件或目录>：查找其更改时间较指定文件或目录的更改时间更接近现在的文件或目录；
-nogroup：找出不属于本地主机群组识别码的文件或目录；
-noleaf：不去考虑目录至少需拥有两个硬连接存在；
-nouser：找出不属于本地主机用户识别码的文件或目录；
-ok<执行指令>：此参数的效果和指定“-exec”类似，但在执行指令之前会先询问用户，若回答“y”或“Y”，则放弃执行命令；
-path<范本样式>：指定字符串作为寻找目录的范本样式；
-perm<权限数值>：查找符合指定的权限数值的文件或目录；
-print：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出。格式为每列一个名称，每个名称前皆有“./”字符串；
-print0：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出。格式为全部的名称皆在同一行；
-printf<输出格式>：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出。格式可以自行指定；
-prune：不寻找字符串作为寻找文件或目录的范本样式;
-regex<范本样式>：指定字符串作为寻找文件或目录的范本样式；
-size<文件大小>：查找符合指定的文件大小的文件；
-true：将find指令的回传值皆设为True；
-type<文件类型>：只寻找符合指定的文件类型的文件；
-uid<用户识别码>：查找符合指定的用户识别码的文件或目录；
-used<日数>：查找文件或目录被更改之后在指定时间曾被存取过的文件或目录，单位以日计算；
-user<拥有者名称>：查找符和指定的拥有者名称的文件或目录；
-version或——version：显示版本信息；
-xdev：将范围局限在先行的文件系统中；
-xtype<文件类型>：此参数的效果和指定“-type”参数类似，差别在于它针对符号连接检查。
```

## grep

Linux find 命令用来在指定目录下查找文件。任何位于参数之前的字符串都将被视为欲查找的目录名。如果使用该命令时，不设置任何参数，则 find 命令将在当前目录下查找子目录与文件。并且将查找到的子目录和文件全部进行显示。

```shell
find   path   -option   [   -print ]   [ -exec   -ok   command ]   {} \;
```

- grep去除文本中的空行：`grep -v '^ *$' list.txt > list_new.txt`。grep -v 使用正则对文本文件进行<u>反向过滤</u>。

| 选项 | 描述                                                         |
| :--- | :----------------------------------------------------------- |
| -i   | 忽略大小写。不会区分大小写字符。也可用--ignore-case 来指定。 |
| -v   | 不匹配。通常，grep 程序会打印包含匹配项的文本行。这个选项导致 grep 程序 只会不包含匹配项的文本行。也可用--invert-match 来指定。 |
| -c   | 打印匹配的数量（或者是不匹配的数目，若指定了-v 选项），而不是文本行本身。 也可用--count 选项来指定。 |
| -l   | 打印包含匹配项的文件名，而不是文本行本身，也可用--files-with-matches 选项来指定。 |
| -L   | 相似于-l 选项，但是只是打印不包含匹配项的文件名。也可用--files-without-match 来指定。 |
| -n   | 在每个匹配行之前打印出其位于文件中的相应行号。也可用--line-number 选项来指定。 |
| -h   | 应用于多文件搜索，不输出文件名。也可用--no-filename 选项来指定。 |

## diff

Linux diff命令用于比较文件的差异。

diff以逐行的方式，比较文本文件的异同处。如果指定要比较目录，则diff会比较目录中相同文件名的文件，但默认不会比较其中子目录。

```shell
diff [-abBcdefHilnNpPqrstTuvwy][-<行数>][-C <行数>][-D <巨集名称>][-I <字符或字符串>][-S <文件>][-W <宽度>][-x <文件或目录>][-X <文件>][--help][--left-column][--suppress-common-line][文件或目录1][文件或目录2]
```

```
[root@localhost test3]# diff log2014.log log2013.log 
3c3
< 2014-03
---
> 2013-03
8c8
< 2013-07
---
> 2013-08
11,12d10
< 2013-11
< 2013-12
```

上面的"3c3"和"8c8"表示log2014.log和log20143log文件在3行和第8行内容有所不同；"11,12d10"表示第一个文件比第二个文件多了第11和12行。



## md5sum

```shell
生成
md5sum testfile > testfile.md5
检查
md5sum testfile -c testfile.md5
```



## cp

```
cp [options] source dest
```

```
-a：此参数的效果和同时指定"-dpR"参数相同；
-d：当复制符号连接时，把目标文件或目录也建立为符号连接，并指向与源文件或目录连接的原始文件或目录；
-f：强行复制文件或目录，不论目标文件或目录是否已存在；
-i：覆盖既有文件之前先询问用户；
-l：对源文件建立硬连接，而非复制文件；
-p：保留源文件或目录的属性；
-R/r：递归处理，将指定目录下的所有文件与子目录一并处理；
-s：对源文件建立符号连接，而非复制文件；
-u：使用这项参数后只会在源文件的更改时间较目标文件更新时或是名称相互对应的目标文件并不存在时，才复制文件；
-S：在备份文件时，用指定的后缀“SUFFIX”代替文件的默认后缀；
-b：覆盖已存在的文件目标前将目标文件备份；
-v：详细显示命令执行的操作。
```

- 增量备份：`cp -ur work.d work.bak`



## ps



## od

按字节列出文件内容。可以按照8进制或16进制列出文件各个字节内容，观察和分析二进制文件。



## tar

磁带归档命令。原来用于将一批文件或目录树与磁带进行导入导出。现在用于压缩或解压缩文件/目录树。





